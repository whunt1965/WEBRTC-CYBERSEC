# Exploiting a TURN server
This repository contains the tools we utilized while exploring how a malicious party might compromise the information collected by a TURN server.

## Background

### What is a TURN server?

A TURN (**T**raversal **U**sing **R**elay around **N**AT) server is used for relaying network traffic. In a WebRTC context, a TURN server is utilized when a direct Peer-to-Peer connection is not possible, and instead the TURN server serves as intermediary to send packets (media streams, data, etc.) between peers. The below image shows how a TURN server may be used (in addition to signalling and STUN servers) as part of a WebRTC session.

<div align="center"><a href="url"><img src="https://github.com/whunt1965/WEBRTC-CYBERSEC/blob/main/turn.jpg" align="center"></a>
  
  *Source: reproduced by Apollo based on https://stackoverflow.com/questions/12708252/how-does-webrtc-work*</div>
  
### How and why would an attacker compromise a TURN server?
While there are many options for free STUN servers readily available for WebRTC developers (eg, Google's 'stun:stun1.l.google.com:19302'), free TURN servers are not nearly as prevalent. A STUN server simply is used to exchange IP information in order to set up a call and is NOT used to relay media streams (which is done via a direct P2P connection or via TURN server). Thus, the bandwith costs for a STUN server are very low. Meanwhile, a TURN server is responsible for relaying all data between 2 peers, which requires much more bandwith and makes these servers much more expensive to operate. Indeed, [one article we read](https://bloggeek.me/google-free-turn-server/) detailed a stress test they conducted on [testRTC](https://testrtc.com) in which they estimated that 500 users (which is not out of line for a public server) would generate 52Gb of traffic through the server in less than 7 minutes. 

Given this lack of free/readily-available TURN server options, we uncovered a number of posts online (including [this one on GitHub](https://gist.github.com/sagivo/3a4b2f2c7ac6e1b5267c2f1f59ac6c6b) providing a list of "free" TURN servers (ie, TURN servers whose URL's and credentials have been published somewhere online) for developers to utilize. 

Indeed, we found one TURN server url/credential combination in particular that was published across multiple different sites (GitHub, StackOverflow,etc.). Out of curiosity, I did a GitHub search on this server and found that it was used in roughly **1000** files on GitHub. 




## Attack Exploration

### Set-Up
In setting up our MiTM attack online, we ran into the issue where users who were behind firewalls could not connect via WebRTC. So, to get around these firewalls, we both set up TURN Servers using [coTurn - an open source TURN Server project](https://github.com/coturn/coturn) on Google Cloud Compute engine virtual machines (using previously acquired domain names for each TURN Server). In setting up these TURN servers, we followed a number of different tutorials, but found [this article](https://ourcodeworld.com/articles/read/1175/how-to-create-and-configure-your-own-stun-turn-server-with-coturn-in-ubuntu-18-04) to be the most useful given that we were using Ubuntu systems.

Set-up instructions and an example configuration file are included in the [ExampleConfig folder](https://github.com/whunt1965/WEBRTC-CYBERSEC/tree/main/TurnExploits/ExampleConfig).

### Enabling TURN Logs

### Parsing the Data

### Exploration of how this Data could be Used by an Attacker


### Next Steps 
